<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตะกร้าสินค้า</title>
    <link rel="icon" type="image/png" href="./images/LOGO.png">
    <link href="https://fonts.googleapis.com/css?family=Itim&display=swap" rel="stylesheet" />
    <link href="./css/DraftBucket.css" rel="stylesheet" />
</head>
<body>
    <header>
        <div class="logo-box"><img src="./images/LOGO.png"></div>
        <div class="nav-box nav-item" onclick="selectHome()">หน้าแรก</div>
        <div class="dropdown-box nav-item" onclick="toggleDropdown()">
            <span id="categoryLabel">หมวดหมู่ ▼</span>
            <div class="dropdown-content" id="categoryDropdown">
                <a class='Category' href="#" onclick="selectCategory('ตลก')">ตลก</a>
                <a class='Category' href="#" onclick="selectCategory('วิทยาศาสตร์')">วิทยาศาสตร์</a>
                <a class='Category' href="#" onclick="selectCategory('ดราม่า')">ดราม่า</a>
                <a class='Category' href="#" onclick="selectCategory('โรแมนติก')">โรแมนติก</a>
            </div>
        </div>

        <div class="search-container">
            <input type="text" class="search-textbox" placeholder="ค้นหาหนังสือ...">
            <button class="search-box">ค้นหา</button>
        </div>
        
        <div class="login-box nav-item">เข้าสู่ระบบ</div>
        <div class="register-box nav-item selected">ตะกร้า</div>
    </header>

    <div class="page-title-box">ตะกร้าสินค้า</div>

    <div class="cart-container">
        <div class="cart-items">
            <div class="cart-item">
                <div class="item-image" style="background-image: url('./images/sakamoto.png')"></div>
                <div class="item-details">
                    <h3>Sakamoto desu ga?</h3>
                    <p>ผู้แต่ง: นาโนะ ยูกิ</p>
                    <p>สำนักพิมพ์: สำนักพิมพ์ ABC</p>
                    <p class="price">250 บาท</p>
                </div>
                <div class="rental-dates">
                    <p><strong>วันที่เช่า:</strong> 15/12/2024</p>
                    <p><strong>วันหมดอายุ:</strong> 22/12/2024</p>
                </div>
                <div class="item-controls">
                    <button class="edit-btn" onclick="editItem(1)">แก้ไขรายละเอียดสินค้า</button>
                </div>
            </div>

            <div class="cart-item">
                <div class="item-image" style="background-image: url('./images/detective.png')"></div>
                <div class="item-details">
                    <h3>มนต์รักฉบับนักสืบ</h3>
                    <p>ผู้แต่ง: ผู้แต่ง D</p>
                    <p>สำนักพิมพ์: สำนักพิมพ์ GHI</p>
                    <p class="price">320 บาท</p>
                </div>
                <div class="rental-dates">
                    <p><strong>วันที่เช่า:</strong> 16/12/2024</p>
                    <p><strong>วันหมดอายุ:</strong> 30/12/2024</p>
                </div>
                <div class="item-controls">
                    <button class="edit-btn" onclick="editItem(2)">แก้ไขรายละเอียดสินค้า</button>
                </div>
            </div>
        </div>

        <div class="cart-summary">
            <div class="summary-box">
                <h3>สรุปคำสั่งซื้อ</h3>
                <div class="summary-item">
                    <span>Sakamoto desu ga?</span>
                    <span>250 บาท</span>
                </div>
                <div class="summary-item">
                    <span>มนต์รักฉบับนักสืบ</span>
                    <span>320 บาท</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-total">
                    <span>รวมทั้งหมด</span>
                    <span>570 บาท</span>
                </div>
                <button class="checkout-btn" onclick="proceedToCheckout()">ดำเนินการชำระเงิน</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <div class="modal-body">
                <h3 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">แก้ไขรายละเอียดสินค้า</h3>
                <table class="edit-form" style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td style="width: 50%; vertical-align: top; padding-right: 15px;">
                            <label>ชื่อเรื่อง:</label><br>
                            <input type="text" id="editTitle" class="edit-input" readonly style="background-color: #f5f5f5; width: 100%; margin-bottom: 15px;">
                            
                            <label>สำนักพิมพ์:</label><br>
                            <input type="text" id="editPublisher" class="edit-input" readonly style="background-color: #f5f5f5; width: 100%; margin-bottom: 15px;">
                            
                            <label>หมวดหมู่:</label><br>
                            <input type="text" id="editCategory" class="edit-input" readonly style="background-color: #f5f5f5; width: 100%;">
                        </td>
                        
                        <td style="width: 50%; vertical-align: top; padding-left: 15px;">
                            <label>วันที่เช่า:</label><br>
                            <input type="date" id="editRentalDate" class="edit-input" onchange="calculateExpiryDate()" style="width: 100%; margin-bottom: 15px;">
                            
                            <label>ระยะเวลายืม:</label><br>
                            <select id="rentalDuration" class="edit-input" onchange="calculateExpiryDate()" style="width: 100%; margin-bottom: 15px;">
                                <option value="7">7 วัน</option>
                                <option value="14">14 วัน</option>
                                <option value="30">30 วัน</option>
                                <option value="60">60 วัน</option>
                                <option value="90">90 วัน</option>
                            </select>
                            
                            <label>วันหมดอายุ:</label><br>
                            <input type="text" id="editExpiryDate" class="edit-input" readonly style="background-color: #f5f5f5; width: 100%;">
                        </td>
                    </tr>
                </table>
                
                <div class="edit-buttons" style="margin-top: 20px; text-align: center;">
                    <button class="save-btn" onclick="saveChanges()">บันทึก</button>
                    <button class="cancel-btn" onclick="closeEditModal()">ยกเลิก</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleDropdown() {
            document.getElementById("categoryDropdown").classList.toggle("show");
        }
        
        function selectCategory(category) {
            document.getElementById("categoryLabel").textContent = category + " ▼";
            document.getElementById("categoryDropdown").classList.remove("show");
        }

        function selectHome() {
            window.location.href = "./HomeUser.html";
        }

        function editItem(itemId) {
            if (itemId === 1) {
                document.getElementById("editTitle").value = "Sakamoto desu ga?";
                document.getElementById("editPublisher").value = "สำนักพิมพ์ ABC";
                document.getElementById("editCategory").value = "ตลก";
                document.getElementById("editRentalDate").value = "2024-12-15";
                document.getElementById("rentalDuration").value = "7";
            } else {
                document.getElementById("editTitle").value = "มนต์รักฉบับนักสืบ";
                document.getElementById("editPublisher").value = "สำนักพิมพ์ GHI";
                document.getElementById("editCategory").value = "โรแมนติก";
                document.getElementById("editRentalDate").value = "2024-12-16";
                document.getElementById("rentalDuration").value = "14";
            }
            calculateExpiryDate();
            document.getElementById("editModal").style.display = "block";
        }
        
        function calculateExpiryDate() {
            const rentalDate = document.getElementById("editRentalDate").value;
            const duration = parseInt(document.getElementById("rentalDuration").value);

            if (rentalDate && duration) {
                const startDate = new Date(rentalDate);
                const expiryDate = new Date(startDate);
                expiryDate.setDate(startDate.getDate() + duration);

                // แสดงวันหมดอายุเป็น DD/MM/YYYY
                const expiryDay = String(expiryDate.getDate()).padStart(2, '0');
                const expiryMonth = String(expiryDate.getMonth() + 1).padStart(2, '0');
                const expiryYear = expiryDate.getFullYear();

                document.getElementById("editExpiryDate").value = `${expiryMonth}/${expiryDay}/${expiryYear}`;

                // แปลงวันที่เช่าเป็น DD/MM/YYYY ด้วย
                const rentalDay = String(startDate.getDate()).padStart(2, '0');
                const rentalMonth = String(startDate.getMonth() + 1).padStart(2, '0');
                const rentalYear = startDate.getFullYear();

                // อัพเดตวันที่เช่าในหน้าหลัก
                updateMainPageDate(`${rentalMonth}/${rentalDay}/${rentalYear}`, `${expiryMonth}/${expiryDay}/${expiryYear}`);
            }
        }
        
        function updateMainPageDate(rentalDateISO, expiryDateFormatted) {
            // แปลงวันที่เช่าจาก YYYY-MM-DD เป็น DD/MM/YYYY
            const date = new Date(rentalDateISO);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const rentalDateFormatted = `${day}/${month}/${year}`;
            
            // อัพเดตวันที่ในหน้าหลัก (อาจต้องปรับปรุงตาม itemId ที่กำลังแก้ไข)
            console.log('วันที่เช่า:', rentalDateFormatted);
            console.log('วันหมดอายุ:', expiryDateFormatted);
        }

        function closeEditModal() {
            document.getElementById("editModal").style.display = "none";
        }

        function saveChanges() {
            alert("บันทึกการเปลี่ยนแปลงแล้ว!");
            closeEditModal();
        }

        function proceedToCheckout() {
            alert("ไปยังหน้าชำระเงิน!");
        }

        window.onclick = function(event) {
            if (!event.target.matches('span')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    dropdowns[i].classList.remove('show');
                }
            }
        }
    </script>
</body>
</html>